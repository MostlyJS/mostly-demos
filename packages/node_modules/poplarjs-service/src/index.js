const mostly = require('mostly-node');
const nats = require('nats');
const poplar = require('mostly-poplarjs');

const { config } = require('common');
const dummyApiV1 = require('./v1/dummy_api');
const dummyApiV1_1 = require('./v1.1/dummy_api');

const trans = new mostly(nats.connect(config.nats), {
  name: 'poplarjs-services',
  logLevel: 'info'
});

trans.ready(() => {
  var app = poplar.create(trans)
    .use(dummyApiV1)
    .use(dummyApiV1_1)
    .handler();
});

trans.onError(e => {
  console.error('Error [' + config.nats + ']: ' + e);
  process.exit();
});