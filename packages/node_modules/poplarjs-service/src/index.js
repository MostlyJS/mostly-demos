import nats from 'nats';
import mostly from 'mostly-node';
import poplar from 'mostly-poplarjs';
import dummyApiV1 from './v1/dummy_api';
import dummyApiV1_1 from './v1.1/dummy_api';
import { config } from 'common';

const trans = new mostly(nats.connect(config.nats), {
  logLevel: 'info'
});

trans.ready(() => {
  var app = poplar.create(trans)
    .use(dummyApiV1)
    .use(dummyApiV1_1)
    .handler();
});

trans.onError(e => {
  console.error('Error [' + config.nats + ']: ' + e);
  process.exit();
});